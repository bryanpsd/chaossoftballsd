---
import { ClientRouter } from "astro:transitions";
import { GoogleAnalytics } from "~/layouts/GoogleAnalytics";
import { Seo } from "~/layouts/Seo";

const { seo, image, noIndex = false, withBaseHref } = Astro.props;

const url = Astro.url.href;
const baseHref = url.endsWith("/") ? url : `${url}/`;
const canonicalURL = url;

const schema = {
	"@context": "https://schema.org",
	"@type": "SportsTeam",
	name: "Chaos Softball San Diego",
	sport: "Softball",
	url: "https://chaossoftballsd.com",
	logo: "https://chaossoftballsd.com/chaos-logo-large.png",
	memberOf: {
		"@type": "SportsOrganization",
		name: "San Diego Youth Softball",
	},
	address: {
		"@type": "PostalAddress",
		addressLocality: "San Diego",
		addressRegion: "CA",
		addressCountry: "US",
	},
};
---

<head>
	<Seo
		seo={seo}
		image={image}
		canonical={canonicalURL}
		noIndex={noIndex}
		schema={schema}
	/>

  {withBaseHref && <base href={baseHref} />}

  {/* Resource Hints for Google Fonts */}
  <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link rel="dns-prefetch" href="//fonts.googleapis.com" />
  <link rel="dns-prefetch" href="//fonts.gstatic.com" />

  {/* Icons & Manifest */}
  <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96" />
  <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
  <link rel="shortcut icon" href="/favicon.ico" />
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
  <link rel="manifest" href="/site.webmanifest" />
  <link rel="sitemap" href="/sitemap-index.xml" />
</head>

<ClientRouter />

<GoogleAnalytics measurementId={"G-C3WFCBGF96"} />
<script is:inline>
	if ("serviceWorker" in navigator) {
		window.addEventListener("load", async () => {
			try {
				// Unregister existing service workers to clear old config
				const registrations = await navigator.serviceWorker.getRegistrations();
				await Promise.all(registrations.map(reg => reg.unregister()));
				
				// Register fresh service worker
				await navigator.serviceWorker.register("/sw.js", { scope: "/" });
			} catch (error) {
				console.error("Service worker registration failed:", error);
			}
		});
	}
</script>
